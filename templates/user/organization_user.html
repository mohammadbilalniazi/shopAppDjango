{% extends "master.html" %}
{% load static %}

{% block title %}Add User To Organization{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'admin/css/base.css' %}">
<link rel="stylesheet" href="{% static 'admin/css/forms.css' %}">
<link rel="stylesheet" href="{% static 'admin/css/nav_sidebar.css' %}">
<link rel="stylesheet" href="{% static 'admin/css/responsive.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/common.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/fontawesome.min.css' %}">
<style>

    body {
      background-color: antiquewhite;
      font-family: Arial, sans-serif;
    }

    .inputs {
      width: 100%;
      padding: 6px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    select, input[type=text], input[type=number] {
      font-weight: 700;
      font-size: 15px;
    }

    td {
      font-weight: 700;
      font-size: 16px;
      color: darkred;
      padding: 8px;
    }

    .alert {
      padding: 8px;
      border-radius: 4px;
      margin-bottom: 10px;
      color: white;
    }

    .alert-danger {
      background-color: crimson;
    }

    .alert-success {
      background-color: seagreen;
    }

    .header-title {
      color: rgb(255, 174, 0);
      font-weight: bold;
      text-align: center;
      font-size: 40px;
      margin: 10px 0;
    }

    .breadcrumbs {
      margin: 15px;
      font-size: 14px;
    }

    .results table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .results th, .results td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
    }

    .results th {
      background: #f4f4f4;
    }

    .btn {
      padding: 6px 12px;
      border-radius: 4px;
      text-decoration: none;
      color: white;
      font-weight: 600;
      font-size: 14px;
    }

    .btn-success { background: seagreen; }
    .btn-danger { background: crimson; }
    .btn:hover { opacity: 0.85; }
  
</style>
{% endblock %}

{% block content %}
<div class="container" style="max-width: 1400px; margin: 20px auto; padding: 20px;">
    
    {% if messages %}
        {% for message in messages %}
            {% if message.tags == "error" %}
                <div class='alert alert-danger' style="background-color:rgb(176, 122, 122);font-weight:bolder;text-align:center;padding:12px;font-size:15px">
            {% else %}
                <div class='alert alert-success' style="background-color:lightgreen;font-weight:bolder;text-align:center;padding:12px;font-size:15px">
            {% endif %}
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
  <!-- Main Content -->
  <main id="main" class="main shifted">
    <fieldset class="module aligned">
      <!-- Form -->
      <form id="organization_user_form" method="post" action="{{request.META.HTTP_NAME}}/user/organization_user/insert/" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Messages -->
        {% if messages %}
          {% for message in messages %}
            <div class="alert {% if message.tags == 'error' %}alert-danger{% else %}alert-success{% endif %}">
              {{ message }}
            </div>
          {% endfor %}
        {% endif %}

        <table>
          <tr>
            <td>System Id</td>
            <td colspan="2">
              {{organization_user.id}}
              <input type="hidden" class="inputs" name="id" id="id" value="{{organization_user.id}}" disabled>
            </td>
          </tr>

          <tr>
            <td>First Name</td>
            <td colspan="2">
              <input type="text" class="inputs" oninput="search()" name="first_name" id="first_name" value="{{organization_user.user.first_name|default:''}}">
            </td>
            <td>Last Name</td>
            <td colspan="2">
              <input type="text" class="inputs" oninput="search()" name="last_name" id="last_name" value="{{organization_user.user.last_name|default:''}}">
            </td>
          </tr>

          <tr>
            <td>User Name</td>
            <td colspan="2">
              <input type="text" class="inputs" oninput="search()" name="username" id="username" value="{{organization_user.user.username|default:''}}">
            </td>
            <td>Password</td>
            <td colspan="2">
              <input type="text" class="inputs" name="password" id="password">
            </td>
          </tr>

          <tr>
            <td>Upload Image</td>
            <td colspan="2">
              <input type="file" class="inputs" name="img" id="img">
            </td>
            <td>Organization</td>
            <td colspan="2">
              <select name="organization" class="inputs" id="organization" onchange="search()">
                {% for organization in organizations %}
                  <option value="{{organization.id}}" {% if organization_user.organization == organization %}selected{% endif %}>
                    {{organization}}
                  </option>
                {% endfor %}
              </select>
            </td>
          </tr>

          <tr>
            <td>Role</td>
            <td colspan="2">
              <select name="role" class="inputs" id="role">
                <option value="employee" {% if organization_user.role == "employee" %}selected{% endif %}>Employee</option>
                <option value="admin" {% if organization_user.role == "admin" %}selected{% endif %}>Admin</option>
                <option value="superuser" {% if organization_user.role == "superuser" %}selected{% endif %}>Super User</option>
                <option value="owner" {% if organization_user.role == "owner" %}selected{% endif %}>Organization Owner</option>
              </select>
            </td>
            <td colspan="3">
              <div style="display: flex; gap: 10px; align-items: center;">
                <input type="text" 
                       placeholder="ðŸ” Search by name or username..." 
                       class="inputs" 
                       id="search_user_input" 
                       oninput="search()"
                       style="flex: 1; padding: 8px 12px; border: 2px solid #3498db; border-radius: 6px; font-size: 14px;">
                <input type="submit" 
                       value="{% if organization_user %} Update User {% else %} Create User {% endif %}" 
                       class="btn btn-success" 
                       id="create_user"
                       style="white-space: nowrap;">
              </div>
            </td>
          </tr>
        </table>
      </form>

      <!-- Results Table -->
      <div class="results">
        <table id="result_list">
          <thead>
            <tr>
              <th>Organization</th>
              <th>User</th>
              <th>First Name</th>
              <th>Last Name</th>
              <th>Role</th>
               <th>Profile</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="organization_user_body"></tbody>
        </table>
        <div id="pagination_id"></div>
      </div>
    </fieldset>
  </main>

  <!-- Footer -->
  <footer id="footer"></footer>

  <!-- Scripts -->
  <script src="/static/assets/js/common_entities/call_shirkat.js"></script>
  <script src="/static/assets/js/user/organization_user.js"></script>
</div>
{% endblock %}

{% block scripts %}
{{ block.super }}
<script src="{% static 'assets/js/alert.js' %}"></script>
<script src="{% static 'assets/js/axios.min.js' %}"></script>
<script src="{% static 'assets/js/cookie.js' %}"></script>
<script src="{% static 'assets/js/common_entities/create_element.js' %}"></script>
<script src="{% static 'assets/js/common_entities/call_shirkat.js' %}"></script>
<script src="{% static 'assets/js/user/organization_user.js' %}"></script>

<script>
  // Clear search when form is submitted
  document.getElementById('organization_user_form').addEventListener('submit', function() {
    const searchInput = document.getElementById('search_user_input');
    if (searchInput) {
      searchInput.value = '';
    }
  });
</script>
{% endblock %}
